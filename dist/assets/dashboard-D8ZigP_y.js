import"./supabaseClient-B0Gv5ww8.js";const a=window.sb,s=e=>document.getElementById(e);async function l(){const{data:{session:e}}=await a.auth.getSession();return e||(window.location.href="/login.html",null)}function c(e){if(!e)return"Usuario";const t=e.split("@")[0]||"Usuario";return t.charAt(0).toUpperCase()+t.slice(1)}async function d(e){try{const{data:t,error:n}=await a.from("profiles").select("full_name").eq("id",e).single();return n?null:t?.full_name||null}catch{return null}}function f(){const e=s("user-menu-button"),t=s("user-menu");if(!e||!t)return;const n=()=>t.classList.toggle("hidden");e.addEventListener("click",i=>{i.stopPropagation(),n()}),document.addEventListener("click",()=>t.classList.add("hidden")),document.addEventListener("keydown",i=>{i.key==="Escape"&&t.classList.add("hidden")})}async function m(){const e=await l();if(!e)return;const t=e.user;let n=await d(t.id);n||(n=t.user_metadata?.full_name||c(t.email));const i=s("user-name-header"),o=s("user-name-greeting");i&&(i.textContent=n||"Usuario"),o&&(o.textContent=n||"Usuario"),f(),s("btn-logout")?.addEventListener("click",async()=>{await a.auth.signOut(),window.location.href="/index.html"}),a.auth.onAuthStateChange((r,u)=>{(r==="SIGNED_OUT"||!u)&&(window.location.href="/index.html")})}m();
